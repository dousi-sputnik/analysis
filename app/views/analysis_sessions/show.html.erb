<%= render 'shared/header' %>
<div class="masthead" style="background-image: url(<%= asset_pack_path 'media/images/analysis.jpg' %>);">  
  <h2><%= @analysis_session.title %></h2>
  <p><%= @analysis_session.description %></p>

  <%= form_with url: show_item_analysis_session_path(@analysis_session), method: :get, local: true do |form| %>
    <div class="input-group mb-3">
      <%= form.text_field :jan_code, class: 'form-control', placeholder: 'JANコードを入力(JANコードが0から始まる場合EXCELの仕様で消えている場合が多いです。PB品の場合ヒットしない可能性が高いです。)', aria: { label: 'JANコード' } %>
      <button class="btn btn-outline-secondary" type="submit">検索</button>
    </div>
  <% end %>

  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>JANコード</th>
        <th>商品名</th>
        <th>売上高</th>
        <th>累計売上高</th>
        <th>累計売上割合</th>
        <th>分類</th>
      </tr>
    </thead>
    <tbody>
      <% @analysis_session.analysis_results.each do |result| %>
        <tr>
          <td>
            <%= link_to result.jan_code, show_item_analysis_session_path(@analysis_session, jan_code: result.jan_code), target: '_blank' %>
          </td>
          <td><%= result.product_name %></td>
          <td><%= result.sales %></td>
          <td><%= result.cumulative_sales %></td>
          <td><%= number_to_percentage(result.cumulative_percentage, precision: 2) %></td>
          <td><%= result.classification %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= link_to 'Excelでダウンロード', analysis_session_path(@analysis_session, format: :xlsx) %>
  <%= link_to 'Back', user_items_path(current_user) %>
</div>
